local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Zmienne konfiguracyjne
_G.AutoFarmRunning = true
_G.AutoFarmActive = false
local currentSpeed = 20 -- Startowa prędkość
local minSpeed = 15
local maxSpeed = 25

-- Tworzenie GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "MM2_Ultimate_GUI"

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Frame.Position = UDim2.new(0.05, 0, 0.4, 0)
Frame.Size = UDim2.new(0, 180, 0, 120) -- Trochę wyższe, żeby zmieścić suwak
Frame.Active = true
Frame.Draggable = true

local UICorner = Instance.new("UICorner")
UICorner.Parent = Frame

-- Przycisk Zamknięcia (X)
local CloseButton = Instance.new("TextButton")
CloseButton.Parent = Frame
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
CloseButton.Position = UDim2.new(0.85, 0, -0.05, 0)
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(1, 0)
CloseCorner.Parent = CloseButton

-- Przycisk Toggle
local ToggleButton = Instance.new("TextButton")
ToggleButton.Parent = Frame
ToggleButton.BackgroundColor3 = Color3.fromRGB(150, 40, 40)
ToggleButton.Position = UDim2.new(0.1, 0, 0.15, 0)
ToggleButton.Size = UDim2.new(0.8, 0, 0.3, 0)
ToggleButton.Text = "AUTO-FARM: OFF"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.SourceSansBold
local TCorner = Instance.new("UICorner")
TCorner.Parent = ToggleButton

-- Suwak (Slider) - Kontener
local SliderFrame = Instance.new("Frame")
SliderFrame.Name = "SliderFrame"
SliderFrame.Parent = Frame
SliderFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
SliderFrame.Position = UDim2.new(0.1, 0, 0.65, 0)
SliderFrame.Size = UDim2.new(0.8, 0, 0.05, 0)

-- Przycisk suwaka
local SliderButton = Instance.new("TextButton")
SliderButton.Name = "SliderButton"
SliderButton.Parent = SliderFrame
SliderButton.BackgroundColor3 = Color3.fromRGB(100, 100, 255)
SliderButton.Position = UDim2.new(0.5, -5, -1.5, 0) -- Start na środku
SliderButton.Size = UDim2.new(0, 10, 0, 20)
SliderButton.Text = ""
local SCorner = Instance.new("UICorner")
SCorner.Parent = SliderButton

-- Napis prędkości
local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Parent = Frame
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Position = UDim2.new(0.1, 0, 0.75, 0)
SpeedLabel.Size = UDim2.new(0.8, 0, 0.2, 0)
SpeedLabel.Font = Enum.Font.SourceSansItalic
SpeedLabel.Text = "Speed: 20 studs/s"
SpeedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
SpeedLabel.TextSize = 12

-- Logika Suwaka
local dragging = false

SliderButton.MouseButton1Down:Connect(function()
    dragging = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local mousePos = UserInputService:GetMouseLocation().X
        local framePos = SliderFrame.AbsolutePosition.X
        local frameSize = SliderFrame.AbsoluteSize.X
        local percentage = math.clamp((mousePos - framePos) / frameSize, 0, 1)
        
        SliderButton.Position = UDim2.new(percentage, -5, -1.5, 0)
        currentSpeed = minSpeed + (percentage * (maxSpeed - minSpeed))
        SpeedLabel.Text = "Speed: " .. math.floor(currentSpeed) .. " studs/s"
    end
end)

-- Funkcja szukania monet
local function getClosestCoin()
    local char = player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return nil end
    local closest, shortestDist = nil, math.huge
    for _, v in pairs(workspace:GetDescendants()) do
        if (v.Name == "Coin_Server" or v.Name == "Coin") and v:IsA("BasePart") then
            local dist = (root.Position - v.Position).Magnitude
            if dist < shortestDist then
                shortestDist = dist
                closest = v
            end
        end
    end
    return closest
end

-- Główna pętla
task.spawn(function()
    while _G.AutoFarmRunning do
        if _G.AutoFarmActive then
            local target = getClosestCoin()
            local char = player.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")
            if target and root then
                local distance = (root.Position - target.Position).Magnitude
                local duration = distance / currentSpeed
                local tween = TweenService:Create(root, TweenInfo.new(duration, Enum.EasingStyle.Linear), {CFrame = target.CFrame})
                tween:Play()
                tween.Completed:Wait()
            end
        end
        task.wait(0.1)
    end
end)

-- Obsługa Toggle
ToggleButton.MouseButton1Click:Connect(function()
    _G.AutoFarmActive = not _G.AutoFarmActive
    ToggleButton.Text = _G.AutoFarmActive and "AUTO-FARM: ON" or "AUTO-FARM: OFF"
    ToggleButton.BackgroundColor3 = _G.AutoFarmActive and Color3.fromRGB(40, 150, 40) or Color3.fromRGB(150, 40, 40)
end)

-- Obsługa Zamknięcia
CloseButton.MouseButton1Click:Connect(function()
    _G.AutoFarmRunning = false
    _G.AutoFarmActive = false
    ScreenGui:Destroy()
end)
