-- lua script  

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

_G.Active = true          -- ZAWSZE AKTYWNY
_G.Running = true
_G.UseTween = false       -- false = TELEPORT, true = TWEEN
local speed = 22
local ignored = {}

-- ===== SPAWN =====
local function getSpawnCFrame()
    if player.RespawnLocation then
        return player.RespawnLocation.CFrame + Vector3.new(0, 3, 0)
    end

    local spawn = workspace:FindFirstChildWhichIsA("SpawnLocation", true)
    if spawn then
        return spawn.CFrame + Vector3.new(0, 3, 0)
    end

    return CFrame.new(0, 10, 0)
end

-- ===== GUI =====
if player.PlayerGui:FindFirstChild("FastFarm") then
    player.PlayerGui.FastFarm:Destroy()
end

local sg = Instance.new("ScreenGui")
sg.Name = "FastFarm"
sg.Parent = player:WaitForChild("PlayerGui")
sg.ResetOnSpawn = false

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0, 180, 0, 45)
btn.Position = UDim2.new(0.5, -90, 0.05, 0)
btn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
btn.Text = "AUTOFARM: ON"
btn.TextColor3 = Color3.new(1,1,1)
btn.Font = Enum.Font.SourceSansBold
btn.TextSize = 18
btn.Parent = sg
Instance.new("UICorner", btn)

local modeBtn = Instance.new("TextButton")
modeBtn.Size = UDim2.new(0, 180, 0, 35)
modeBtn.Position = UDim2.new(0.5, -90, 0.05, 50)
modeBtn.BackgroundColor3 = Color3.fromRGB(160, 60, 60)
modeBtn.Text = "MODE: TELEPORT"
modeBtn.TextColor3 = Color3.new(1,1,1)
modeBtn.Font = Enum.Font.SourceSansBold
modeBtn.TextSize = 16
modeBtn.Parent = sg
Instance.new("UICorner", modeBtn)

-- ===== NOCLIP =====
RunService.Stepped:Connect(function()
    local char = player.Character
    if char then
        for _, v in pairs(char:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = false
            end
        end
    end
end)

-- ===== AUTOFARM =====
task.spawn(function()
    while _G.Running do
        local char = player.Character or player.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")

        local target, dist = nil, math.huge

        for _, v in pairs(workspace:GetDescendants()) do
            if (v.Name == "Coin_Server" or v.Name == "Coin")
                and v:IsA("BasePart")
                and not ignored[v] then
                local d = (root.Position - v.Position).Magnitude
                if d < dist then
                    dist = d
                    target = v
                end
            end
        end

        if target then
            local targetCF = target.CFrame * CFrame.new(0, 3, 0)

            if _G.UseTween then
                local tween = TweenService:Create(
                    root,
                    TweenInfo.new(dist / speed, Enum.EasingStyle.Linear),
                    {CFrame = targetCF}
                )
                tween:Play()

                while target and target.Parent
                    and (root.Position - target.Position).Magnitude > 3 do
                    task.wait()
                end

                tween:Cancel()
                ignored[target] = true
            else
                -- TELEPORT LOGICZNY
                task.wait(dist / speed)

                if target and target.Parent then
                    -- na coin
                    root.CFrame = targetCF

                    -- 0.3s na coinie + liczenie nastÄ™pnego
                    local start = tick()
                    while tick() - start < 0.3 do
                        task.wait()
                    end

                    ignored[target] = true

                    -- teleport na SPAWN
                    root.CFrame = getSpawnCFrame()
                end
            end
        else
            ignored = {}
            task.wait(0.1)
        end

        task.wait()
    end
end)

-- ===== TRYB =====
modeBtn.MouseButton1Click:Connect(function()
    _G.UseTween = not _G.UseTween
    modeBtn.Text = _G.UseTween and "MODE: TWEEN" or "MODE: TELEPORT"
    modeBtn.BackgroundColor3 = _G.UseTween
        and Color3.fromRGB(60, 60, 160)
        or Color3.fromRGB(160, 60, 60)
end)
