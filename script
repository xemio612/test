-- ANTI AFK made by Muscle_legends2021 [Gio]
 
local VirtualUser = game:GetService('VirtualUser')
 
game:GetService('Players').LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)
 
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "AntiAFK loaded!",
    Text = "Made by Gio",
    Button1 = "Thanks",
    Duration = 5
})

-- SERVICES
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

-- GLOBALS
_G.Active = false
_G.Running = true
_G.AutoReset = true

local speed = 22
local coinCount = 0
local ignored = {}
local isFirstCoin = true -- Zmienna do obsługi teleportu

-- GUI CLEANUP
if player.PlayerGui:FindFirstChild("FastFarm") then
	player.PlayerGui.FastFarm:Destroy()
end

-- SCREEN GUI
local sg = Instance.new("ScreenGui")
sg.Name = "FastFarm"
sg.Parent = player.PlayerGui
sg.ResetOnSpawn = false

-- MAIN FRAME
local main = Instance.new("Frame")
main.Parent = sg
main.Size = UDim2.new(0, 270, 0, 320)
main.Position = UDim2.new(0.5, -135, 0.5, -160)
main.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
main.Active = true
main.ClipsDescendants = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 18)

-- STROKE (NEON)
local stroke = Instance.new("UIStroke", main)
stroke.Thickness = 2
stroke.Color = Color3.fromRGB(120, 120, 255)

-- HEADER (Strefa przesuwania)
local header = Instance.new("TextLabel", main)
header.Size = UDim2.new(1, 0, 0, 50) -- Powiększony obszar łapania
header.Position = UDim2.new(0, 0, 0, 0)
header.Text = "      EXOTIC HUB"
header.Font = Enum.Font.GothamBold
header.TextSize = 22
header.TextColor3 = Color3.fromRGB(230, 230, 255)
header.BackgroundTransparency = 1
header.TextXAlignment = Enum.TextXAlignment.Left
header.Active = true -- Ważne dla przesuwania

-- DRAG LOGIC (Tylko dla Headera)
do
	local dragging, dragStart, startPos
	header.InputBegan:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = i.Position
			startPos = main.Position
		end
	end)
	
	UserInputService.InputChanged:Connect(function(i)
		if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = i.Position - dragStart
			main.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
	
	UserInputService.InputEnded:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
end

-- CLOSE BUTTON
local close = Instance.new("TextButton", main)
close.Size = UDim2.new(0, 30, 0, 30)
close.Position = UDim2.new(1, -40, 0, 10)
close.Text = "X"
close.Font = Enum.Font.GothamBold
close.TextSize = 16
close.TextColor3 = Color3.new(1,1,1)
close.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
close.ZIndex = 5
Instance.new("UICorner", close).CornerRadius = UDim.new(1, 0)

close.MouseButton1Click:Connect(function()
	_G.Active = false
	_G.Running = false
	sg:Destroy()
end)

-- TOGGLE FUNCTION
local function createToggle(text, y, default, callback)
	local holder = Instance.new("Frame", main)
	holder.Size = UDim2.new(1, -40, 0, 42)
	holder.Position = UDim2.new(0, 20, 0, y)
	holder.BackgroundTransparency = 1

	local label = Instance.new("TextLabel", holder)
	label.Size = UDim2.new(1, -70, 1, 0)
	label.Text = text
	label.Font = Enum.Font.GothamBold
	label.TextSize = 16
	label.TextColor3 = Color3.fromRGB(235,235,235)
	label.BackgroundTransparency = 1
	label.TextXAlignment = Enum.TextXAlignment.Left

	local toggle = Instance.new("Frame", holder)
	toggle.Size = UDim2.new(0, 42, 0, 22)
	toggle.Position = UDim2.new(1, -42, 0.5, -11)
	toggle.BackgroundColor3 = default and Color3.fromRGB(60, 200, 120) or Color3.fromRGB(200, 70, 70)
	Instance.new("UICorner", toggle).CornerRadius = UDim.new(1, 0)

	local knob = Instance.new("Frame", toggle)
	knob.Size = UDim2.new(0, 18, 0, 18)
	knob.Position = default and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)
	knob.BackgroundColor3 = Color3.fromRGB(245,245,245)
	Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)

	local hit = Instance.new("TextButton", toggle)
	hit.Size = UDim2.new(1,0,1,0)
	hit.Text = ""
	hit.BackgroundTransparency = 1

	local state = default
	hit.MouseButton1Click:Connect(function()
		state = not state
		if text == "Auto Farm" then isFirstCoin = true end -- Resetuj teleport przy włączeniu
		TweenService:Create(toggle, TweenInfo.new(0.2),
			{BackgroundColor3 = state and Color3.fromRGB(60,200,120) or Color3.fromRGB(200,70,70)}
		):Play()
		TweenService:Create(knob, TweenInfo.new(0.2),
			{Position = state and UDim2.new(1,-20,0.5,-9) or UDim2.new(0,2,0.5,-9)}
		):Play()
		callback(state)
	end)
end

createToggle("Auto Farm", 70, false, function(v)
	_G.Active = v
end)

createToggle("Reset When Full Bag", 120, true, function(v)
	_G.AutoReset = v
end)

-- SPEED TITLE
local speedTitle = Instance.new("TextLabel", main)
speedTitle.Size = UDim2.new(1, 0, 0, 30)
speedTitle.Position = UDim2.new(0, 0, 0, 175)
speedTitle.Text = "Farm Speed"
speedTitle.Font = Enum.Font.GothamBold
speedTitle.TextSize = 18
speedTitle.TextColor3 = Color3.fromRGB(230,230,255)
speedTitle.BackgroundTransparency = 1

-- SLIDER BAR
local bar = Instance.new("Frame", main)
bar.Size = UDim2.new(1, -60, 0, 8)
bar.Position = UDim2.new(0, 30, 0, 220)
bar.BackgroundColor3 = Color3.fromRGB(60,60,70)
Instance.new("UICorner", bar).CornerRadius = UDim.new(1,0)

local fill = Instance.new("Frame", bar)
fill.Size = UDim2.new((speed-15)/10, 0, 1, 0)
fill.BackgroundColor3 = Color3.fromRGB(120,120,255)
Instance.new("UICorner", fill).CornerRadius = UDim.new(1,0)

local knobS = Instance.new("Frame", bar)
knobS.Size = UDim2.new(0, 16, 0, 16)
knobS.Position = UDim2.new((speed-15)/10, -8, 0.5, -8)
knobS.BackgroundColor3 = Color3.fromRGB(245,245,245)
Instance.new("UICorner", knobS).CornerRadius = UDim.new(1,0)

local value = Instance.new("TextLabel", main)
value.Size = UDim2.new(1,0,0,20)
value.Position = UDim2.new(0,0,0,240)
value.Text = tostring(speed)
value.Font = Enum.Font.GothamBold
value.TextSize = 14
value.TextColor3 = Color3.fromRGB(230,230,230)
value.BackgroundTransparency = 1

-- SLIDER LOGIC (Naprawione)
local sliding = false
local function updateSlider()
	local mousePos = UserInputService:GetMouseLocation().X
	local barPos = bar.AbsolutePosition.X
	local barSize = bar.AbsoluteSize.X
	local x = math.clamp((mousePos - barPos) / barSize, 0, 1)
	
	speed = math.floor(15 + x * 85) -- Zwiększyłem zakres do 100 dla testu
	fill.Size = UDim2.new(x, 0, 1, 0)
	knobS.Position = UDim2.new(x, -8, 0.5, -8)
	value.Text = tostring(speed)
end

knobS.InputBegan:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		sliding = true
	end
end)

UserInputService.InputEnded:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		sliding = false
	end
end)

UserInputService.InputChanged:Connect(function(i)
	if sliding and i.UserInputType == Enum.UserInputType.MouseMovement then
		updateSlider()
	end
end)

-- NOCLIP
RunService.Stepped:Connect(function()
	if _G.Active and player.Character then
		for _,v in pairs(player.Character:GetDescendants()) do
			if v:IsA("BasePart") then
				v.CanCollide = false
			end
		end
	end
end)

-- COIN TOUCH
local function setupTouch(char)
	local root = char:WaitForChild("HumanoidRootPart")
	root.Touched:Connect(function(hit)
		if _G.Active and (hit.Name=="Coin" or hit.Name=="Coin_Server") and not ignored[hit] then
			ignored[hit] = true
			coinCount += 1
		end
	end)
end

if player.Character then setupTouch(player.Character) end
player.CharacterAdded:Connect(function(char)
	coinCount = 0
	ignored = {}
	isFirstCoin = true
	setupTouch(char)
end)

-- FARM LOOP
task.spawn(function()
	while _G.Running do
		if _G.Active then
			if _G.AutoReset and coinCount >= 40 then
				_G.Active = false
				player.Character.Humanoid.Health = 0
				player.CharacterAdded:Wait()
				task.wait(1)
				isFirstCoin = true
				_G.Active = true
			end

			local char = player.Character
			local root = char and char:FindFirstChild("HumanoidRootPart")
			if root then
				local target, dist = nil, math.huge
				for _,v in pairs(workspace:GetDescendants()) do
					if (v.Name=="Coin" or v.Name=="Coin_Server")
						and v:IsA("BasePart")
						and not ignored[v] then
						local d = (root.Position - v.Position).Magnitude
						if d < dist then
							dist = d
							target = v
						end
					end
				end

				if target then
					if isFirstCoin then
						-- NATYCHMIASTOWY TELEPORT DLA PIERWSZEGO COINA
						root.CFrame = target.CFrame * CFrame.new(0, 3, 0)
						isFirstCoin = false
						task.wait(0.1)
					else
						-- NORMALNY TWEEN DLA RESZTY
						local tween = TweenService:Create(
							root,
							TweenInfo.new(dist/speed, Enum.EasingStyle.Linear),
							{CFrame = target.CFrame * CFrame.new(0,3,0)}
						)
						tween:Play()
						
						while _G.Active and target.Parent and not isFirstCoin 
							and (root.Position - target.Position).Magnitude > 2 do
							task.wait()
						end
						tween:Cancel()
					end
					ignored[target] = true
				else
					ignored = {}
					task.wait(0.1)
				end
			end
		end
		task.wait()
	end
end)
