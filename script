local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

_G.Active = false
_G.Running = true -- Zmienna do całkowitego stopu pętli
local speed = 21
local ignored = {}

-- 1. USUWANIE STARYCH WERSJI
if player.PlayerGui:FindFirstChild("SimpleFarm") then player.PlayerGui.SimpleFarm:Destroy() end

-- 2. STWORZENIE GUI
local sg = Instance.new("ScreenGui")
sg.Name = "SimpleFarm"
sg.Parent = player:WaitForChild("PlayerGui")
sg.ResetOnSpawn = false

-- GŁÓWNY PRZYCISK
local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0, 150, 0, 50)
btn.Position = UDim2.new(0.5, -75, 0.05, 0)
btn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
btn.Text = "AUTO-FARM: OFF"
btn.TextColor3 = Color3.new(1, 1, 1)
btn.Font = Enum.Font.SourceSansBold
btn.TextSize = 18
btn.Parent = sg
Instance.new("UICorner", btn)

-- PRZYCISK X (ZAMKNIJ)
local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 25, 0, 25)
close.Position = UDim2.new(0.5, 85, 0.05, 0) -- Tuż obok przycisku farmy
close.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
close.Text = "X"
close.TextColor3 = Color3.new(1, 1, 1)
close.Parent = sg
Instance.new("UICorner", close).CornerRadius = UDim.new(1, 0)

-- 3. NOCLIP
RunService.Stepped:Connect(function()
    if _G.Active and player.Character then
        for _, part in pairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

-- 4. PĘTLA RUCHU
task.spawn(function()
    while _G.Running do -- Pętla działa tylko dopóki nie klikniesz X
        if _G.Active then
            local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            local target = nil
            local dist = math.huge
            
            for _, v in pairs(workspace:GetDescendants()) do
                if (v.Name == "Coin_Server" or v.Name == "Coin") and v:IsA("BasePart") and not ignored[v] then
                    local d = (root.Position - v.Position).Magnitude
                    if d < dist then dist = d; target = v end
                end
            end
            
            if target and root then
                local tween = TweenService:Create(root, TweenInfo.new(dist/speed, Enum.EasingStyle.Linear), {CFrame = target.CFrame})
                tween:Play()
                
                repeat task.wait() until not target or not target.Parent or not _G.Active or (root.Position - target.Position).Magnitude < 3
                
                if target then ignored[target] = true end
                tween:Cancel()
            else
                ignored = {}
                task.wait(0.5)
            end
        end
        task.wait()
    end
end)

-- 5. OBSŁUGA PRZYCISKÓW
btn.MouseButton1Click:Connect(function()
    _G.Active = not _G.Active
    btn.Text = _G.Active and "AUTO-FARM: ON" or "AUTO-FARM: OFF"
    btn.BackgroundColor3 = _G.Active and Color3.fromRGB(50, 150, 50) or Color3.fromRGB(150, 50, 50)
end)

close.MouseButton1Click:Connect(function()
    _G.Active = false
    _G.Running = false -- To zabija pętlę w tle
    sg:Destroy() -- Usuwa GUI
end)
