-- WYMUSZONE CZYSZCZENIE
for _, v in pairs(game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui"):GetChildren()) do
    if v.Name == "CustomMM2_Hub" then v:Destroy() end
end

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Zmienne
_G.FarmActive = false
_G.AutoReset = false
_G.FlySpeed = 20
_G.Running = true
local ignoredCoins = {}

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CustomMM2_Hub"
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.DisplayOrder = 999 -- Sprawia, że będzie nad innymi GUI
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame")
Main.Name = "Main"
Main.Parent = ScreenGui
Main.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
Main.Position = UDim2.new(0.1, 0, 0.1, 0) -- Lewy górny róg (bezpieczniej)
Main.Size = UDim2.new(0, 200, 0, 250)
Main.Active = true
Main.Draggable = true

-- Upiększenie (UICorner)
local function round(obj)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, 8)
    c.Parent = obj
end
round(Main)

local Title = Instance.new("TextLabel")
Title.Parent = Main
Title.Size = UDim2.new(1, 0, 0, 35)
Title.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
Title.Text = "MM2 HUB [FIXED]"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 16
round(Title)

-- PRZYCISKI
local FarmBtn = Instance.new("TextButton")
FarmBtn.Parent = Main
FarmBtn.Position = UDim2.new(0.1, 0, 0.2, 0)
FarmBtn.Size = UDim2.new(0.8, 0, 0, 40)
FarmBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
FarmBtn.Text = "START FARM"
FarmBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
round(FarmBtn)

local ResetBtn = Instance.new("TextButton")
ResetBtn.Parent = Main
ResetBtn.Position = UDim2.new(0.1, 0, 0.4, 0)
ResetBtn.Size = UDim2.new(0.8, 0, 0, 40)
ResetBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
ResetBtn.Text = "AUTO-RESET: OFF"
ResetBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
round(ResetBtn)

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Parent = Main
SpeedLabel.Position = UDim2.new(0, 0, 0.6, 0)
SpeedLabel.Size = UDim2.new(1, 0, 0, 20)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Text = "Speed: 20"
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

local Close = Instance.new("TextButton")
Close.Parent = Main
Close.Position = UDim2.new(0.8, 0, -0.05, 0)
Close.Size = UDim2.new(0, 25, 0, 25)
Close.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
Close.Text = "X"
Close.TextColor3 = Color3.fromRGB(255, 255, 255)
round(Close)

-- LOGIKA NOCLIP
RunService.Stepped:Connect(function()
    if _G.FarmActive and player.Character then
        for _, v in pairs(player.Character:GetDescendants()) do
            if v:IsA("BasePart") then v.CanCollide = false end
        end
    end
end)

-- SZUKANIE MONET
local function getCoin()
    local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not root then return nil end
    local closest, dist = nil, math.huge
    for _, v in pairs(workspace:GetDescendants()) do
        if (v.Name == "Coin_Server" or v.Name == "Coin") and v:IsA("BasePart") and not ignoredCoins[v] then
            local d = (root.Position - v.Position).Magnitude
            if d < dist then dist = d; closest = v end
        end
    end
    return closest
end

-- PĘTLA
task.spawn(function()
    while _G.Running do
        if _G.FarmActive then
            local target = getCoin()
            local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if target and root then
                local duration = (root.Position - target.Position).Magnitude / _G.FlySpeed
                local tween = TweenService:Create(root, TweenInfo.new(duration, Enum.EasingStyle.Linear), {CFrame = target.CFrame})
                tween:Play()
                repeat task.wait() until not target or not target.Parent or not _G.FarmActive or (root.Position - target.Position).Magnitude < 2.5
                if target then ignoredCoins[target] = true end
                tween:Cancel()
            else
                ignoredCoins = {}
                task.wait(1)
            end
        end
        task.wait()
    end
end)

-- OBSŁUGA
FarmBtn.MouseButton1Click:Connect(function()
    _G.FarmActive = not _G.FarmActive
    FarmBtn.Text = _G.FarmActive and "STOP FARM" or "START FARM"
    FarmBtn.BackgroundColor3 = _G.FarmActive and Color3.fromRGB(50, 150, 50) or Color3.fromRGB(45, 45, 55)
end)

ResetBtn.MouseButton1Click:Connect(function()
    _G.AutoReset = not _G.AutoReset
    ResetBtn.Text = _G.AutoReset and "AUTO-RESET: ON" or "AUTO-RESET: OFF"
end)

Close.MouseButton1Click:Connect(function()
    _G.Running = false
    _G.FarmActive = false
    ScreenGui:Destroy()
end)

warn("SKRYPT MM2 URUCHOMIONY!")
